<!DOCTYPE html>
<html>

<head>
   <title>test side</title>

   <!--
<meta name="viewport" content="initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="manifest" href="/manifest.json">

-->

   <link rel="manifest" href="manifest.json">

   <meta name="mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="application-name" content="Kjetil - Test">
   <meta name="apple-mobile-web-app-title" content="Kjetil - Test">
   <meta name="msapplication-starturl" content="/index.html">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

   <link rel="icon" type="image/png" sizes="192x192" href="images/appIcon.png">
   <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="images/appIcon.png">

   <meta charset="utf-8" />

   <script src="scripts/global.js" type="text/javascript"></script>
   <script src="scripts/validateInfo.js" type="text/javascript"></script>
   <script src="scripts/script.js" type="text/javascript"></script>
   <script src="scripts/intervals.js" type="text/javascript"></script>

</head>

<body>

   <div id="container">

      Info side:
      <br><br>
      <button onClick="location.reload()">Oppdater siden</button><br>
      <p>Sist oppdatert:</p>
      <p id="updateTime"></p>

      <p id="info"></p>

      Sider:
      <br><br>

      <button onClick="location.href = 'index.html'">index</button>
      <button onClick="location.href = 'login.html'">login</button>
      <button onClick="location.href = 'access.html'">access</button>

      <br><br>

      <button onClick="loadPage('index')">index (ajax)</button>
      <button onClick="loadPage('login')">login (ajax)</button>
      <button onClick="loadPage('access')">access (ajax)</button>
      <br>
      <p id="testmessage"></p>

      <form id="askForAccess">

         <input id="displayname" placeholder="displayname" type="text" required="true">
         <input id="username" placeholder="username" type="text" required="true">
         <input id="psw" placeholder="password" type="password" required="true">
         <input id="confirmPsw" placeholder="confirm password" type="password" required="true">

         <input type="submit" value="Be om tilgang">
      </form>

      <p id="askForAccesMsg"></p>


      <button onClick="testFunction()">test token</button><br>

      <p id="showLocalStorage"></p>

   </div>

</body>

<script>

   async function testFunction() {
      const token = localStorage.getItem("authToken");
      const user = localStorage.getItem("user");
      const body = { "authToken": token, "userInfo": user };
      const url = `/validate`;

      let resp = callServerAPI(body, url);
   }

   // show localstorage list
   showLocalStorageList()
   function showLocalStorageList() {

      let keys = Object.keys(localStorage);
      const showLocalStorage = document.getElementById("showLocalStorage");
      showLocalStorage.innerHTML = "";

      if (keys.length > 0) {
         showLocalStorage.innerHTML = "Localstorage items: <br><br>";
         for (let i = 0; i < keys.length; i++) {
            showLocalStorage.innerHTML += keys[i] + ": " + localStorage.getItem(keys[i]) + "<br>";
         }

         showLocalStorage.innerHTML += "<br> <button onClick='localStorage.clear()'>Clear localstorage</button>"

      }

   }

   //

   // ask for access
   const askForAccess = document.getElementById("askForAccess");

   askForAccess.addEventListener("submit", async function (evt) {

      evt.preventDefault();

      const displayname = document.getElementById("displayname").value;
      const username = document.getElementById("username").value;
      const psw = document.getElementById("psw").value;
      const confirmPsw = document.getElementById("confirmPsw").value;

      let resp = await validate(displayname, username, psw, confirmPsw);

      //console.log(resp)

      const askForAccesMsg = document.getElementById("askForAccesMsg");
      askForAccesMsg.innerHTML = resp;

   });

   //

   //let test = validate("Kjetil Kristiansen", "kjetkr01", "123", "123");
   let names = ["Kjetil", "Simonso", "Kristian", "Christian", "Trym"];
   let randomNum = Math.floor(Math.random() * names.length);


   let stopIntervalsTest = false;

   let autoUpdate = setInterval(() => {

      if (stopIntervalsTest) {
         clearInterval(autoUpdate);
         return;
      }

      let test1 = isGymOpen();
      let test2 = partOfDayMessage(names[randomNum]);
      document.getElementById("testmessage").innerHTML = `
      ${test1.message}
      <br>
      ${test1.timeLeft}
      <br>
      ${test2}
      `;

   }, 1000);

   let program = { "Mandag": "Bein og mage", "Tirsdag": "Rygg og biceps" };

   let resp = whatToTrainToday(program)
   console.log(resp)

   // til testing

   updateTime()

   function updateTime() {
      let d = new Date();
      document.getElementById("updateTime").innerHTML = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      const html = `
      Screensize:
      <br>
      H: ${window.screen.availHeight} px<br>
      W: ${window.screen.availWidth} px
      `;
      document.getElementById("info").innerHTML = html;
   }

</script>

</html>