<!DOCTYPE html>
<html>

<head>
   <title>test side</title>

   <!--
<meta name="viewport" content="initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="manifest" href="/manifest.json">

-->

   <link rel="manifest" href="manifest.json">

   <meta name="mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="application-name" content="Treningsstatestikk">
   <meta name="apple-mobile-web-app-title" content="Treningsstatestikk">
   <meta name="msapplication-starturl" content="/">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

   <link rel="icon" type="image/png" sizes="192x192" href="images/appIcon.png">
   <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="images/appIcon.png">

   <meta charset="utf-8" />

   <script src="scripts/global.js" type="text/javascript"></script>
   <script src="scripts/validateInfo.js" type="text/javascript"></script>
   <script src="scripts/script.js" type="text/javascript"></script>

</head>

<body>

   <div id="container">

      Info side:
      <br><br>
      <button onClick="location.reload()">Oppdater siden</button><br>
      <p>Sist oppdatert:</p>
      <p id="updateTime"></p>

      <p id="info"></p>

      Sider:
      <br><br>

      <button onClick="location.href = 'index.html'">index</button>
      <button onClick="location.href = 'login.html'">login</button>
      <button onClick="location.href = 'access.html'">access</button>

      <br><br>

      <!--
         Trenger ikke dette allikevel?
      <button onClick="loadPage('index')">index (ajax)</button>
      <button onClick="loadPage('login')">login (ajax)</button>
      <button onClick="loadPage('access')">access (ajax)</button>
      <br>
      -->

      <p id="testmessage"></p>

      <button onClick="location.href = 'test-login.html'">login-test</button>
      <button onClick="test()">liste med alle brukere</button>
      <p id="testmessagediv"></p>

      <button onClick="test2()">liste med alle forespørseler (brukere)</button>
      <p id="testmessagediv2"></p>

      <p id="showLocalStorage"></p>

   </div>

</body>

<script>


   async function test() {

      const token = localStorage.getItem("authToken");
      const user = localStorage.getItem("user");

      if (token && user) {

         const body = { "authToken": token, "userInfo": user };
         const url = `/users/list/all`;

         const resp = await callServerAPI(body, url);

         const testmessagediv = document.getElementById("testmessagediv");

         testmessagediv.innerHTML = "";

         if (resp[0].username) {

            for (let i = 0; i < resp.length; i++) {
               testmessagediv.innerHTML += "Brukernavn: " + resp[i].username + "<br>";
            }

            testmessagediv.innerHTML += "Det er totalt " + resp.length + " brukere!";

         }

      }
   }

   async function test2() {

      const token = localStorage.getItem("authToken");
      const user = localStorage.getItem("user");

      if (token && user) {

         const body = { "authToken": token, "userInfo": user };
         const url = `/users/list/pending`;

         const resp = await callServerAPI(body, url);

         const testmessagediv2 = document.getElementById("testmessagediv2");

         testmessagediv2.innerHTML = "";

         if (resp[0].username) {

            for (let i = 0; i < resp.length; i++) {
               testmessagediv2.innerHTML += "Brukernavn: " + resp[i].username + "<br>";
            }

            testmessagediv2.innerHTML += "Det er totalt " + resp.length + " forespørseler (brukere)!";

         }

      }
   }

   let stopIntervalsTest = true; // stop auto update

   let autoUpdate = setInterval(() => {

      if (stopIntervalsTest) {
         clearInterval(autoUpdate);
         return;
      }

      let test1 = isGymOpen();
      let test2 = partOfDayMessage("Kjetil");
      document.getElementById("testmessage").innerHTML = `
      ${test1.message}
      <br>
      ${test1.timeLeft}
      <br>
      ${test2}
      `;

   }, 1000);







   // til testing / ekstra ting

   updateTime()
   function updateTime() {
      let d = new Date();
      document.getElementById("updateTime").innerHTML = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      const html = `
      Screensize:
      <br>
      H: ${window.screen.availHeight} px<br>
      W: ${window.screen.availWidth} px
      `;
      document.getElementById("info").innerHTML = html;
   }

   // show localstorage list

   showLocalStorageList()
   function showLocalStorageList() {

      let keys = Object.keys(localStorage);
      const showLocalStorage = document.getElementById("showLocalStorage");
      showLocalStorage.innerHTML = "";

      if (keys.length > 0) {
         showLocalStorage.innerHTML = "Localstorage items: <br><br>";
         for (let i = 0; i < keys.length; i++) {
            showLocalStorage.innerHTML += keys[i] + ": " + localStorage.getItem(keys[i]) + "<br>";
         }

         showLocalStorage.innerHTML += "<br> <button onClick='localStorage.clear()'>Clear localstorage</button>"

      }

   }

   //

</script>

</html>