<!DOCTYPE html>
<html>

<head>
   <title>test side</title>

   <meta charset="utf-8" />

   <!-- manifest -->

   <link rel="manifest" href="manifest.json">

   <meta name="mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="application-name" content="Treningsstatestikk">
   <meta name="apple-mobile-web-app-title" content="Treningsstatestikk">
   <meta name="msapplication-starturl" content="/">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

   <link rel="icon" type="image/png" sizes="192x192" href="images/appIcon.png">
   <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="images/appIcon.png">

   <!-- -->

   <script src="scripts/global.js" type="text/javascript"></script>
   <script src="scripts/validateInfo.js" type="text/javascript"></script>
   <script src="scripts/script.js" type="text/javascript"></script>

</head>

<body>

   <div id="container">

      Info side:
      <br><br>
      <button onClick="location.reload()">Oppdater siden</button><br>
      <p>Sist oppdatert:</p>
      <p id="updateTime"></p>

      <p id="info"></p>

      Sider:
      <br><br>

      <button onClick="location.href = 'index.html'">index</button>
      <button onClick="location.href = 'login.html'">login</button>
      <button onClick="location.href = 'access.html'">access</button>

      <br><br>

      <p id="testmessage"></p>

      <button onClick="location.href = 'test-login.html'">login-test</button>
      <button onClick="getListOfAllUsers()">liste med alle brukere</button>
      <p id="getListOfAllUsersDiv"></p>

      <button onClick="getListOfPendingUsers()">liste med alle forespørseler (brukere)</button>
      <div id="listOfPendingUsersDiv"></div>

      <p id="showLocalStorage"></p>
      <p id="showSessionStorage"></p>

   </div>

</body>

<script>

   async function getListOfAllUsers() {

      //const token = localStorage.getItem("authToken");
      //const user = localStorage.getItem("user");

      if (token && user) {

         const body = { "authToken": token, "userInfo": user };
         const url = `/users/list/all`;

         const resp = await callServerAPI(body, url);

         const getListOfAllUsersDiv = document.getElementById("getListOfAllUsersDiv");

         getListOfAllUsersDiv.innerHTML = "";

         if (resp[0].username) {

            for (let i = 0; i < resp.length; i++) {
               getListOfAllUsersDiv.innerHTML += `<div onClick="console.log('Clicked on ${resp[i].username}')">
                  Brukernavn: ${resp[i].username}
                  </div>`;
            }

            getListOfAllUsersDiv.innerHTML += "Det er totalt " + resp.length + " brukere!";

         } else {
            getListOfAllUsersDiv.innerHTML += "Det er ingen brukere!";
         }

      }
   }

   // list of pending users

   async function getListOfPendingUsers() {

      //const token = localStorage.getItem("authToken");
      //const user = localStorage.getItem("user");

      if (token && user) {

         const body = { "authToken": token, "userInfo": user };
         const url = `/users/list/pending`;

         const resp = await callServerAPI(body, url);

         const listOfPendingUsersDiv = document.getElementById("listOfPendingUsersDiv");

         listOfPendingUsersDiv.innerHTML = "";

         if (resp[0].username) {

            for (let i = 0; i < resp.length; i++) {
               listOfPendingUsersDiv.innerHTML += `<div>
               Navn:${resp[i].displayname} Brukernavn: ${resp[i].username}
               <button onClick='acceptPendingUser("${resp[i].username}", true)'>Godta</button>
               <button onClick='acceptPendingUser("${resp[i].username}", false)'>Avslå</button>
               </div>`;
            }

            listOfPendingUsersDiv.innerHTML += "Det er totalt " + resp.length + " forespørseler (brukere)!";

         } else {
            listOfPendingUsersDiv.innerHTML = "Det er ingen forespørseler!";
         }

      }
   }

   test();
   async function test() {

      let resp = await whatToTrainToday();

      if (resp.length > 0) {
         console.log(resp);
      }

   }

   async function acceptPendingUser(username, acceptOrDeny) {
      if (!username || acceptOrDeny === "") {
         return;
      }

      let statusMsg = "godta";
      let statusMsg2 = "Du har nå godtatt forespørselen til: ";

      if (!acceptOrDeny) {
         statusMsg = "avslå";
         statusMsg2 = "Du har nå avslått forespørselen til: ";
      }

      const confirmPress = confirm("Er du sikker på at du vil " + statusMsg + " " + username + " sin forespørsel?");
      if (confirmPress === true) {

         //const token = localStorage.getItem("authToken");
         //const user = localStorage.getItem("user");

         const body = { "authToken": token, "userInfo": user, "pendingUser": username, "acceptOrDeny": acceptOrDeny };
         const url = `/users/pending/${username}/${acceptOrDeny}`;

         const results = await callServerAPI(body, url);

         if (results === "Ok") {
            alert(statusMsg2 + username);
         } else {
            alert("Feil, brukeren finnes ikke!");
         }

         getListOfPendingUsers();
      }
   }

   //

   let stopIntervalsTest = false; // stop auto update

   let autoUpdate = setInterval(() => {

      if (stopIntervalsTest) {
         clearInterval(autoUpdate);
         return;
      }

      let test1 = isGymOpen();
      let test2 = partOfDayMessage(userDisplayname);
      document.getElementById("testmessage").innerHTML = `
      ${test1.message}
      <br>
      ${test1.timeLeft}
      <br>
      ${test2}
      `;

   }, 1000);

   // til testing / ekstra ting

   updateTime()
   function updateTime() {
      let d = new Date();
      document.getElementById("updateTime").innerHTML = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      const html = `
      Screensize:
      <br>
      H: ${window.screen.availHeight} px<br>
      W: ${window.screen.availWidth} px
      `;
      document.getElementById("info").innerHTML = html;
   }

   // show localstorage list

   showLocalStorageList();
   function showLocalStorageList() {

      let keys = Object.keys(localStorage);
      const showLocalStorage = document.getElementById("showLocalStorage");
      showLocalStorage.innerHTML = "";

      if (keys.length > 0) {
         showLocalStorage.innerHTML = "Localstorage items: <br><br>";
         for (let i = 0; i < keys.length; i++) {
            showLocalStorage.innerHTML += keys[i] + ": " + localStorage.getItem(keys[i]) + "<br>";
         }

         showLocalStorage.innerHTML += "<br> <button onClick='localStorage.clear()'>Clear localStorage</button>";

      }
   }

   //

   // show localstorage list

   showSessionStorageList();
   function showSessionStorageList() {

      let keys = Object.keys(sessionStorage);
      const showSessionStorage = document.getElementById("showSessionStorage");
      showSessionStorage.innerHTML = "";

      if (keys.length > 0) {
         showSessionStorage.innerHTML = "SessionStorage items: <br><br>";
         for (let i = 0; i < keys.length; i++) {
            showSessionStorage.innerHTML += keys[i] + ": " + localStorage.getItem(keys[i]) + "<br>";
         }

         showSessionStorage.innerHTML += "<br> <button onClick='sessionStorage.clear()'>Clear sessionStorage</button>";

      }
   }

   //

</script>

</html>