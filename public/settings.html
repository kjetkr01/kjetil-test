<!DOCTYPE html>
<html>

<head>
   <title>Innstillinger</title>

   <meta charset="utf-8" />

   <!-- manifest -->

   <link rel="manifest" href="manifest.json">

   <meta name="mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="application-name" content="Treningsstatistikken">
   <meta name="apple-mobile-web-app-title" content="Treningsstatistikken">
   <meta name="msapplication-starturl" content="/">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=0">

   <link rel="icon" type="image/png" sizes="192x192" href="images/appIcon.png">
   <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="images/appIcon.png">

   <!-- -->

   <!-- status bar color -->

   <meta id="themeColor" name="theme-color" content="#357F9B">
   <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

   <!-- -->

   <link rel="stylesheet" href="styles/global/globalVariables.css">
   <link rel="stylesheet" href="styles/global/globalClasses.css">
   <link rel="stylesheet" href="styles/global/global.css">

   <!-- themeStyleCSS -->
   <link id="themeStyleCSS-default" rel="stylesheet" href="styles/themes/default.css">
   <link id="themeStyleCSS-blue" rel="stylesheet" href="styles/themes/blue.css">
   <!-- themeStyleCSS -->

   <link rel="stylesheet" href="styles/themes/globalThemeValues.css">


   <link rel="stylesheet" href="styles/settings/desktop.css">
   <link rel="stylesheet" href="styles/settings/mobile.css">
   <link rel="stylesheet" href="styles/settings/common.css">

   <link rel="stylesheet" href="styles/settings/settingsGrid.css">
   <!--<link rel="stylesheet" href="styles/index/progressbar.css">-->


   <script src="scripts/global.js" type="text/javascript"></script>
   <script src="scripts/index/script.js" type="text/javascript"></script>

</head>

<body>

   <section id="page">

      <div id="c1r1"></div>
      <div id="c2r1"></div>

      <div id="GbackBtn">
         <svg id="backBtn" class="icons iconsDefaultColor fadeInLeft animate delaySmall" draggable="false"
            onclick="backToPrevious();" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22.49 39.22">
            <g id="Layer_2" data-name="Layer 2">
               <g id="Layer_1-2" data-name="Layer 1">
                  <polyline class="cls-1" points="21.25 1.24 2.48 20.02 20.45 37.99" />
               </g>
            </g>
         </svg>
      </div>

      <div id="Gtitle">
         <p id="title" class="noselect">
            Innstillinger
         </p>
      </div>

      <div id="GsettingsGrid">
         <p id="settingsGrid" class="noselect">
         </p>
      </div>

   </section>

</body>

<script>

   changeColorTheme();

   const titleDom = document.getElementById("title");
   const settingsGrid = document.getElementById("settingsGrid");
   let userInfo = null;

   function backToPrevious() {

      if (titleDom.innerHTML === "Innstillinger") {
         redirectToAccount();
      } else {
         loadDefaultPage();
      }

   }

   function loadSetting(aSetting) {

      const setting = aSetting;
      if (setting) {
         console.log(setting)
         titleDom.innerHTML = setting;
         settingsGrid.innerHTML = "";
         switch (setting) {
            case "Passord":
               loadPasswordPage();
               break;
            case "Om deg":
               loadAboutMePage();
               break;
            case "Utseende":
               loadAppearancePage();
               break;
            default:
               loadDefaultPage();
               break;
         }
      }
   }

   loadDefaultPage();
   async function loadDefaultPage() {

      const resp = await getAccountDetails(userID);

      if (resp.hasOwnProperty("info")) {

         titleDom.innerHTML = "Innstillinger";
         settingsGrid.innerHTML = "";

         const settings = resp.info.settings;
         userinfo = resp.info;

         //settingsGrid.innerHTML += getTemplate("Displayname", "displaynameDiv", userinfo.displayname);
         settingsGrid.innerHTML += getTemplate("Displayname", "displaynameDiv", `<input style="text-align:right;" class='settingsInput' value='${userinfo.displayname}'></input>`, "borderTop");
         //settingsGrid.innerHTML += getTemplate("Brukernavn", "usernameDiv", userinfo.username);
         settingsGrid.innerHTML += getTemplate("Brukernavn", "usernameDiv", `<input style="text-align:right;" class='settingsInput' value='${userinfo.username}'></input>`);

         settingsGrid.innerHTML += getTemplateWithBtn("Passord", "passwordDiv");

         settingsGrid.innerHTML += getTemplateWithBtn("Om deg", "aboutDiv", "spacingTop");

         if (settings.publicProfile.value === true) {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Privat profil", "profileVisibilityDiv", true, "spacingTop");
         } else {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Privat profil", "profileVisibilityDiv", false, "spacingTop");
         }

         if (settings.displayLeaderboards.value === true) {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Ledertavler synlighet", "leaderboardsVisibilityDiv", true);
         } else {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Ledertavler synlighet", "leaderboardsVisibilityDiv", false);
         }

         if (settings.displayWorkoutList.value === true) {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Trener i dag listen synlighet", "workoutTodayListDiv", true);
         } else {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Trener i dag listen synlighet", "workoutTodayListDiv", false);
         }


         settingsGrid.innerHTML += getTemplateWithBtn("Utseende", "appearanceDiv", "spacingTop");
         settingsGrid.innerHTML += getTemplateWithBtn("Fremgangs info", "appearanceDiv");

         settingsGrid.innerHTML += getTemplateWithBtn("Om appen", "aboutAppDiv", "spacingTop");

         if (userinfo.hasOwnProperty("isadmin")) {
            if (userinfo.isadmin === true) {

               settingsGrid.innerHTML += getPendingRequestsTemplate();

            }
         }

         if (userinfo.hasOwnProperty("apikey")) {
            settingsGrid.innerHTML += getTemplateWithBtn("API", "apiDiv");
         }

         settingsGrid.innerHTML += getLogoutBtn();

         if (userinfo.hasOwnProperty("isadmin")) {
            if (userinfo.isadmin === true) {

               const body = { "authToken": token, "userInfo": user, "onlyNumbers": true };
               const url = `/users/list/pending`;

               const resp = await callServerAPI(body, url);

               if (resp) {
                  if (resp.length > 0) {
                     const pendingRequestsTxt = document.getElementsByName("pendingRequestsTxt");
                     pendingRequestsTxt[0].innerHTML = `Forespørsler (${resp.length})`;
                  }
               }
            }
         }

      } else {
         redirectToAccount();
      }
   }

   function loadPasswordPage() {

      settingsGrid.innerHTML = justTextTemplate("Her kan du endre passordet ditt her", "left");

      settingsGrid.innerHTML += getCenteredTextTemplate("Skriv inn eksisterende passord", "", "borderTop");
      settingsGrid.innerHTML += getCenteredTextTemplate("<input class='settingsInput' id='exsistingPsw' type='password' placeholder='Fyll inn'></input>");

      settingsGrid.innerHTML += getCenteredTextTemplate("Skriv inn ditt nye ønskede passord", "usernameDiv", "spacingTop");
      settingsGrid.innerHTML += getCenteredTextTemplate("<input class='settingsInput' id='newPsw' type='password' placeholder='Fyll inn'></input>");

      settingsGrid.innerHTML += getCenteredTextTemplate("Gjenta ditt nye ønskede passord", "usernameDiv", "spacingTop");
      settingsGrid.innerHTML += getCenteredTextTemplate("<input class='settingsInput' id='repeatNewPsw' type='password' placeholder='Fyll inn'></input>");

      settingsGrid.innerHTML += getCenteredTextTemplate(`<button class='settingsButton' onClick="alert('savepsw');">Lagre</button>`, "test", "spacingTop");

   }

   function loadAboutMePage() {

      settingsGrid.innerHTML = justTextTemplate("Her kan du velge høyde, vekt og alder. Om profilen din er offentlig, vises dette til andre", "left");

      settingsGrid.innerHTML += getTemplate("Alder", "ageInp", `<input style="text-align:right;" class='settingsInput' value='${userinfo.info.age}'>år</input>`, "borderTop");

      settingsGrid.innerHTML += getTemplate("Høyde", "heightInp", `<input style="text-align:right;" class='settingsInput' value='${userinfo.info.height}'>cm</input>`, "spacingTop");
      settingsGrid.innerHTML += getTemplate("Vekt", "weightInp", `<input style="text-align:right;" class='settingsInput' value='${userinfo.info.weight}'>kg</input>`);

      settingsGrid.innerHTML += justTextTemplate(`Om du ikke ønsker å velge vekt eller høyde, kan du bruke standard verdier. <button class='settingsButton' onClick="alert('defaultVals');">Trykk her</button>`, "left");

      settingsGrid.innerHTML += getTemplate("Treningssenter", "gymInp", `<input style="text-align:right;" class='settingsInput' value='${userinfo.info.gym}'></input>`, "borderTop");

   }

   function loadAppearancePage() {

      settingsGrid.innerHTML = justTextTemplate("Her kan du endre utseende på appen!", "left");

      const appearanceThemeHTML = `
      <select id="appearanceThemeSelection">
         <option value="1">Automatisk</option>
  </select>
      `;

      settingsGrid.innerHTML += getTemplate("Tema", "appearanceThemeInp", appearanceThemeHTML, "borderTop");

      const themeKeys = Object.keys(allowedThemes);
      let themeColorOptionsHTML = "";
      let colorTheme = allowedThemes[0].theme;
      const preferredTheme = sessionStorage.getItem("colorTheme") || colorTheme;
      for (let i = 0; i < themeKeys.length; i++) {

         if (preferredTheme === allowedThemes[themeKeys[i]].theme) {
            themeColorOptionsHTML += `<option selected="selected" value="${themeKeys[i]}">${allowedThemes[themeKeys[i]].name}</option>`;
         } else {
            themeColorOptionsHTML += `<option value="${themeKeys[i]}">${allowedThemes[themeKeys[i]].name}</option>`;
         }
      }

      const themeColorSelectionHTML = `
      <select id="themeColorSelection">
    ${themeColorOptionsHTML}
  </select>
      `;

      settingsGrid.innerHTML += getTemplate("Farge-tema", "themeColorInp", themeColorSelectionHTML, "borderTop");

   }


   function getTemplate(aSetting, aDivId, aInfo, aSpacingTop) {

      const setting = aSetting || "Innstillingen finnes ikke!";
      const divId = aDivId || "";
      const info = aInfo || "";
      const spacingTop = aSpacingTop || "";
      let borderT = "";

      if (spacingTop) {
         borderT = "borderT";
      }

      const html =
         `
   <div id="${divId}" class="userSettingsDefault noselect ${spacingTop}">
            <div id="cS1" class="${borderT}">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  ${setting}
               </p>
            </div>
            <div id="gsInfo">
               <p id="sInfo">
                  ${info}
               </p>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
   `;
      return html;
   }

   function getTemplateWithBtn(aSetting, aDivId, aSpacingTop) {

      const setting = aSetting || "Innstillingen finnes ikke!";
      const divId = aDivId || "";
      const spacingTop = aSpacingTop || "";
      let borderT = "";

      if (spacingTop) {
         borderT = "borderT";
      }

      const html =
         `
         <div id="${divId}" class="userSettingsDefault noselect ${spacingTop}">
            <div id="cS1" class="${borderT}">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  ${setting}
               </p>
            </div>
            <div id="gsInfo">
               <svg id="sInfo" class="settingsIcons fadeIn" draggable="false" onclick="loadSetting('${setting}');"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22.49 39.22">
                  <g id="Layer_2" data-name="Layer 2">
                     <g id="Layer_1-2" data-name="Layer 1">
                        <polyline class="cls-1" points="1.24 1.24 20.02 20.02 2.04 37.99" />
                     </g>
                  </g>
               </svg>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
`;
      return html;
   }



   function getTemplateWithCheckbox(aSetting, aDivId, aChecked, aSpacingTop) {

      const setting = aSetting || "Innstillingen finnes ikke!";
      const divId = aDivId || "";
      const isChecked = aChecked || false;
      const spacingTop = aSpacingTop || "";
      let borderT = "";

      if (spacingTop) {
         borderT = "borderT";
      }

      let html =
         `
         <div id="${divId}" class="userSettingsDefault noselect ${spacingTop}">
            <div id="cS1" class="${borderT}">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  ${setting}
               </p>
            </div>
            <div id="gsInfo">
               <label id="sInfo" class="settingsCheckbox fadeIn">
                  <input type="checkbox">
                  <span class="slider round"></span>
               </label>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
`;

      if (isChecked === true) {
         html =
            `
         <div id="${divId}" class="userSettingsDefault noselect ${spacingTop}">
            <div id="cS1" class="${borderT}">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  ${setting}
               </p>
            </div>
            <div id="gsInfo">
               <label id="sInfo" class="settingsCheckbox fadeIn">
                  <input type="checkbox" checked>
                  <span class="slider round"></span>
               </label>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
`;
      }

      return html;
   }

   function getLogoutBtn() {

      const html =
         `
<div class="userSettingsDefault noselect spacingTop" style="margin-bottom:80px;">
      <div id="cS1" class="borderT">
      </div>
      <div id="gsSetting">
         <p id="sSetting" style="color:red;" onClick="confirmLogout();">
            Logg ut
         </p>
      </div>
      <div id="gsInfo">
         <p id="sInfo">
            
         </p>
      </div>
      <div id="cS4" class="borderB">
      </div>
   </div>
`;
      return html;
   }


   function confirmLogout() {

      const logout = confirm("Er du sikker på at du vil logge ut?");

      if (logout === true) {

         localStorage.clear();
         sessionStorage.clear();
         redirectToLogin();

      }
   }


   function getPendingRequestsTemplate() {

      const html =
         `
         <div id="pendingRequestsDiv" class="userSettingsDefault noselect">
            <div id="cS1">
            </div>
            <div id="gsSetting">
               <p id="sSetting" name="pendingRequestsTxt">
                  Forespørsler
               </p>
            </div>
            <div id="gsInfo">
               <svg id="sInfo" class="settingsIcons fadeIn" draggable="false" onclick="loadSetting('pendingUsers');"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22.49 39.22">
                  <g id="Layer_2" data-name="Layer 2">
                     <g id="Layer_1-2" data-name="Layer 1">
                        <polyline class="cls-1" points="1.24 1.24 20.02 20.02 2.04 37.99" />
                     </g>
                  </g>
               </svg>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
`;
      return html;
   }

   function getCenteredTextTemplate(aDetails, aDivId, aSpacingTop) {

      const details = aDetails || "Det har oppstått et problem";
      const divId = aDivId || "";
      const spacingTop = aSpacingTop || "";
      let borderT = "";

      if (spacingTop) {
         borderT = "borderT";
      }

      const html =
         `
<div id="${divId}" class="userSettingsCenteredItems noselect ${spacingTop}">
      <div id="cSC1" class="${borderT}">
      </div>
      <div id="gsCenteredItems">
         <p id="sCenteredItems">
            ${details}
         </p>
      </div>
      <div id="cSC2" class="borderB">
      </div>
   </div>
`;
      return html;
   }

   function justTextTemplate(aText, aTextAlign) {

      if (aTextAlign !== "left" && aTextAlign !== "center") {
         aTextAlign = "left";
      }

      const text = aText;
      const textAlign = aTextAlign;

      const html =
         `
<div class="userSettingsJustText noselect" style="text-align: ${textAlign};">
      <div id="cSJC1">
      </div>
      <div id="gsJustText">
         <p id="sJustText">
            ${text}
         </p>
      </div>
      <div id="cSJC2">
      </div>
   </div>
`;
      return html;

   }

</script>

</html>