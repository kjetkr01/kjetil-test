<!DOCTYPE html>
<html>

<head>
   <title>Innstillinger</title>

   <meta charset="utf-8" />

   <!-- manifest -->

   <link rel="manifest" href="manifest.json">

   <meta name="mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="application-name" content="Treningsstatistikken">
   <meta name="apple-mobile-web-app-title" content="Treningsstatistikken">
   <meta name="msapplication-starturl" content="/">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=0">

   <link rel="icon" type="image/png" sizes="192x192" href="images/appIcon.png">
   <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="images/appIcon.png">

   <!-- -->

   <!-- status bar color -->

   <meta id="themeColor" name="theme-color" content="#357F9B">
   <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

   <!-- -->

   <link rel="stylesheet" href="styles/global/globalVariables.css">
   <link rel="stylesheet" href="styles/global/globalClasses.css">
   <link rel="stylesheet" href="styles/global/global.css">

   <!-- themeStyleCSS -->
   <link id="themeStyleCSS-default" rel="stylesheet" href="styles/themes/default.css">
   <link id="themeStyleCSS-blue" rel="stylesheet" href="styles/themes/blue.css">
   <!-- themeStyleCSS -->

   <link rel="stylesheet" href="styles/themes/globalThemeValues.css">


   <link rel="stylesheet" href="styles/settings/desktop.css">
   <link rel="stylesheet" href="styles/settings/mobile.css">
   <link rel="stylesheet" href="styles/settings/common.css">

   <link rel="stylesheet" href="styles/settings/settingsGrid.css">
   <!--<link rel="stylesheet" href="styles/index/progressbar.css">-->


   <script src="scripts/global.js" type="text/javascript"></script>
   <script src="scripts/index/script.js" type="text/javascript"></script>

</head>

<body>

   <section id="page">

      <div id="c1r1"></div>
      <div id="c2r1"></div>

      <div id="GbackBtn">
         <svg id="backBtn" class="icons iconsDefaultColor fadeInLeft animate delaySmall" draggable="false"
            onclick="redirectToAccount();" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22.49 39.22">
            <g id="Layer_2" data-name="Layer 2">
               <g id="Layer_1-2" data-name="Layer 1">
                  <polyline class="cls-1" points="21.25 1.24 2.48 20.02 20.45 37.99" />
               </g>
            </g>
         </svg>
      </div>

      <div id="Gtitle">
         <p id="title" class="noselect">
            Innstillinger
         </p>
      </div>

      <div id="GsettingsGrid">
         <p id="settingsGrid" class="noselect">
            <!-- endres på -->

            <!--
         <div class="userSettingsDefault noselect">
            <div id="cS1">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  Visningsnavn
               </p>
            </div>
            <div id="gsInfo">
               <p id="sInfo">
                  ${displayname}
               </p>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>

         <div class="userSettingsDefault noselect">
            <div id="cS1">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  Brukernavn
               </p>
            </div>
            <div id="gsInfo">
               <p id="sInfo">
                  ${username}
               </p>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>

         <div class="userSettingsDefault noselect">
            <div id="cS1">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  Passord
               </p>
            </div>
            <div id="gsInfo">
               <svg id="sInfo" class="settingsIcons fadeIn" draggable="false" onclick="loadSetting('password');"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22.49 39.22">
                  <g id="Layer_2" data-name="Layer 2">
                     <g id="Layer_1-2" data-name="Layer 1">
                        <polyline class="cls-1" points="1.24 1.24 20.02 20.02 2.04 37.99" />
                     </g>
                  </g>
               </svg>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>

         <div class="userSettingsDefault noselect spacingTop">
            <div id="cS1" class="borderT">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  Om deg
               </p>
            </div>
            <div id="gsInfo">
               <svg id="sInfo" class="settingsIcons fadeIn" draggable="false" onclick="loadSetting('about');"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22.49 39.22">
                  <g id="Layer_2" data-name="Layer 2">
                     <g id="Layer_1-2" data-name="Layer 1">
                        <polyline class="cls-1" points="1.24 1.24 20.02 20.02 2.04 37.99" />
                     </g>
                  </g>
               </svg>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>

         <div class="userSettingsDefault noselect spacingTop">
            <div id="cS1" class="borderT">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  Privat Profil
               </p>
            </div>
            <div id="gsInfo">
               <label id="sInfo" class="settingsCheckbox">
                  <input type="checkbox">
                  <span class="slider round"></span>
               </label>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
         -->
            <!-- slutt på endres på -->
         </p>
      </div>

   </section>

</body>

<script>

   changeColorTheme();

   /* script here */

   function loadSetting(aSetting) {

      const setting = aSetting;
      if (setting) {
         alert(setting);
      }
   }

   const settingsGrid = document.getElementById("settingsGrid");

   loadDefaultPage();
   async function loadDefaultPage() {

      /*const myUsername = username;
      const body = { "authToken": token, "userInfo": user, "viewingUser": myUsername };
      const url = `/users/details/${myUsername}`;

      const resp = await callServerAPI(body, url);*/

      const resp = await getAccountDetails(userID);

      console.log(resp.info)

      if (resp.hasOwnProperty("info")) {

         const settings = resp.info.settings;
         const userinfo = resp.info;

         settingsGrid.innerHTML = "";

         settingsGrid.innerHTML += getTemplate("Displayname", "displaynameDiv", userinfo.displayname);
         settingsGrid.innerHTML += getTemplate("Brukernavn", "usernameDiv", userinfo.username);
         settingsGrid.innerHTML += getTemplateWithBtn("Passord", "passwordDiv");

         settingsGrid.innerHTML += getTemplateWithBtn("Om deg", "aboutDiv", "spacingTop");

         if (settings.publicProfile.value === true) {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Privat profil", "profileVisibilityDiv", true, "spacingTop");
         } else {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Privat profil", "profileVisibilityDiv", false, "spacingTop");
         }

         if (settings.displayLeaderboards.value === true) {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Ledertavler synlighet", "leaderboardsVisibilityDiv", true);
         } else {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Ledertavler synlighet", "leaderboardsVisibilityDiv", false);
         }

         if (settings.displayWorkoutList.value === true) {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Trener i dag listen synlighet", "workoutTodayListDiv", true);
         } else {
            settingsGrid.innerHTML += getTemplateWithCheckbox("Trener i dag listen synlighet", "workoutTodayListDiv", false);
         }


         settingsGrid.innerHTML += getTemplateWithBtn("Utseende", "appearanceDiv", "spacingTop");
         settingsGrid.innerHTML += getTemplateWithBtn("Fremgangs info", "appearanceDiv");

         settingsGrid.innerHTML += getTemplateWithBtn("Om appen", "aboutAppDiv", "spacingTop");

         if (userinfo.hasOwnProperty("isadmin")) {
            if (userinfo.isadmin === true) {

               settingsGrid.innerHTML += getPendingRequestsTemplate();

            }
         }

         if (userinfo.hasOwnProperty("apikey")) {
            settingsGrid.innerHTML += getTemplateWithBtn("API", "apiDiv");
         }

         settingsGrid.innerHTML += getLogoutBtn();

         if (userinfo.hasOwnProperty("isadmin")) {
            if (userinfo.isadmin === true) {

               const body = { "authToken": token, "userInfo": user, "onlyNumbers": true };
               const url = `/users/list/pending`;

               const resp = await callServerAPI(body, url);

               if (resp) {
                  if (resp.length > 0) {
                     const pendingRequestsTxt = document.getElementsByName("pendingRequestsTxt");
                     pendingRequestsTxt[0].innerHTML = `Forespørsler (${resp.length})`;
                  }
               }
            }
         }

      } else {
         redirectToAccount();
      }
   }

   function getTemplate(aSetting, aDivId, aInfo, aSpacingTop) {

      const setting = aSetting || "Innstillingen finnes ikke!";
      const divId = aDivId || "";
      const info = aInfo || "";
      const spacingTop = aSpacingTop || "";
      let borderT = "";

      if (spacingTop) {
         borderT = "borderT";
      }

      const html =
         `
   <div id="${divId}" class="userSettingsDefault noselect ${spacingTop}">
            <div id="cS1" class="${borderT}">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  ${setting}
               </p>
            </div>
            <div id="gsInfo">
               <p id="sInfo">
                  ${info}
               </p>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
   `;
      return html;
   }

   function getTemplateWithBtn(aSetting, aDivId, aSpacingTop) {

      const setting = aSetting || "Innstillingen finnes ikke!";
      const divId = aDivId || "";
      const spacingTop = aSpacingTop || "";
      let borderT = "";

      if (spacingTop) {
         borderT = "borderT";
      }

      const html =
         `
         <div id="${divId}" class="userSettingsDefault noselect ${spacingTop}">
            <div id="cS1" class="${borderT}">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  ${setting}
               </p>
            </div>
            <div id="gsInfo">
               <svg id="sInfo" class="settingsIcons fadeIn" draggable="false" onclick="loadSetting('${setting}');"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22.49 39.22">
                  <g id="Layer_2" data-name="Layer 2">
                     <g id="Layer_1-2" data-name="Layer 1">
                        <polyline class="cls-1" points="1.24 1.24 20.02 20.02 2.04 37.99" />
                     </g>
                  </g>
               </svg>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
`;
      return html;
   }



   function getTemplateWithCheckbox(aSetting, aDivId, aChecked, aSpacingTop) {

      const setting = aSetting || "Innstillingen finnes ikke!";
      const divId = aDivId || "";
      const isChecked = aChecked || false;
      const spacingTop = aSpacingTop || "";
      let borderT = "";

      if (spacingTop) {
         borderT = "borderT";
      }

      let html =
         `
         <div id="${divId}" class="userSettingsDefault noselect ${spacingTop}">
            <div id="cS1" class="${borderT}">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  ${setting}
               </p>
            </div>
            <div id="gsInfo">
               <label id="sInfo" class="settingsCheckbox fadeIn">
                  <input type="checkbox">
                  <span class="slider round"></span>
               </label>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
`;

      if (isChecked === true) {
         html =
            `
         <div id="${divId}" class="userSettingsDefault noselect ${spacingTop}">
            <div id="cS1" class="${borderT}">
            </div>
            <div id="gsSetting">
               <p id="sSetting">
                  ${setting}
               </p>
            </div>
            <div id="gsInfo">
               <label id="sInfo" class="settingsCheckbox fadeIn">
                  <input type="checkbox" checked>
                  <span class="slider round"></span>
               </label>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
`;
      }

      return html;
   }

   function getLogoutBtn() {

      const html =
         `
<div class="userSettingsDefault noselect spacingTop" style="margin-bottom: 80px;">
      <div id="cS1" class="borderT">
      </div>
      <div id="gsSetting">
         <p id="sSetting" style="color:red;" onClick="confirmLogout();">
            Logg ut
         </p>
      </div>
      <div id="gsInfo">
         <p id="sInfo">
            
         </p>
      </div>
      <div id="cS4" class="borderB">
      </div>
   </div>
`;
      return html;
   }


   function confirmLogout() {

      const logout = confirm("Er du sikker på at du vil logge ut?");

      if (logout === true) {

         localStorage.clear();
         sessionStorage.clear();
         redirectToLogin();

      }
   }


   function getPendingRequestsTemplate() {

      const html =
         `
         <div id="pendingRequestsDiv" class="userSettingsDefault noselect">
            <div id="cS1">
            </div>
            <div id="gsSetting">
               <p id="sSetting" name="pendingRequestsTxt">
                  Forespørsler
               </p>
            </div>
            <div id="gsInfo">
               <svg id="sInfo" class="settingsIcons fadeIn" draggable="false" onclick="loadSetting('pendingUsers');"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22.49 39.22">
                  <g id="Layer_2" data-name="Layer 2">
                     <g id="Layer_1-2" data-name="Layer 1">
                        <polyline class="cls-1" points="1.24 1.24 20.02 20.02 2.04 37.99" />
                     </g>
                  </g>
               </svg>
            </div>
            <div id="cS4" class="borderB">
            </div>
         </div>
`;
      return html;
   }

</script>

</html>