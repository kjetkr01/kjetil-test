<!DOCTYPE html>
<html>

<head>
   <title>Min konto</title>

   <meta charset="utf-8" />

   <!-- manifest -->

   <link rel="manifest" href="manifest.json">

   <meta name="mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="application-name" content="Treningsstatistikken">
   <meta name="apple-mobile-web-app-title" content="Treningsstatistikken">
   <meta name="msapplication-starturl" content="/">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=0">

   <link rel="icon" type="image/png" sizes="192x192" href="images/appIcon.png">
   <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="images/appIcon.png">

   <!-- -->

   <!-- status bar color -->

   <meta id="themeColor" name="theme-color" content="#357F9B">
   <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

   <!-- -->

   <link rel="stylesheet" href="styles/global/globalVariables.css">
   <link rel="stylesheet" href="styles/global/globalClasses.css">
   <link rel="stylesheet" href="styles/global/global.css">
   <link rel="stylesheet" href="styles/themes/default.css">


   <link rel="stylesheet" href="styles/account/desktop.css">
   <link rel="stylesheet" href="styles/account/mobile.css">
   <link rel="stylesheet" href="styles/account/common.css">
   <link rel="stylesheet" href="styles/account/overlay.css">

   <link rel="stylesheet" href="styles/badges/badges.css">
   <link rel="stylesheet" href="styles/badges/badgeColors.css">
   <link rel="stylesheet" href="styles/account/userGrid.css">
   <!--<link rel="stylesheet" href="styles/index/progressbar.css">-->

   <script src="scripts/global.js" type="text/javascript"></script>
   <script src="scripts/badges/badges.js" type="text/javascript"></script>
   <script src="scripts/account/account.js" type="text/javascript"></script>

</head>

<body>

   <div id="createNewLiftorGoalOverlay" style="display: none;" class="overlay">
      <div id="createNewLiftorGoal" class="createNewLiftorGoal">
         <div id="Gtitle1">
            <p id="title1"></p>
         </div>
         <div id="Gline1">
            <hr id="line1">
         </div>


         <div id="Gtitle2">
            <p id="title2">Øvelse</p>
         </div>
         <div id="Gline2">
            <hr id="line2">
         </div>
         <div id="Ginp1">
            <select id="inp1">
               <option value="test">Test</option>
            </select>
         </div>

         <div id="Gtitle3">
            <p id="title3">Antall KG</p>
         </div>
         <div id="Gline3">
            <hr id="line3">
         </div>
         <div id="Ginp2">
            <input id="inp2" type="text" onkeypress="return onlyAllowedKeys(event)"></input>
         </div>

         <div id="Gtitle4">
            <p id="title4">Dato</p>
         </div>
         <div id="Gline4">
            <hr id="line4">
         </div>
         <div id="Ginp3">
            <input id="inp3" type="date"></input>
         </div>

         <div id="Gresp">
            <p id="resp"></p>
         </div>

         <div id="Gcancel">
            <button id="cancel" onclick="disableOverlay();">Avbryt</button>
         </div>

         <div id="Gsave">
         </div>

      </div>
   </div>

   <section id="page">

      <div id="c1r1"></div>
      <div id="c2r1"></div>
      <div id="c3r1"></div>
      <div id="c4r1"></div>

      <div id="c1r2"></div>
      <div id="c2r2"></div>
      <div id="c3r2"></div>
      <div id="c4r2"></div>
      <div id="c5r2"></div>
      <div id="c6r2"></div>

      <div id="Gtitle">
         <p id="title" class="noselect fadeInLeft animate">
         </p>
      </div>

      <div id="Ggym">
         <p id="gym" class="noselect fadeIn animate delaySmall">
         </p>
      </div>

      <div id="Ginfo">
         <table id="info" class="infoTable fadeIn animate delayMedium">
            <tr id="infoList">
            </tr>
         </table>
      </div>

      <div id="Gsettings">
         <button id="settings" class="noselect settingsBtn">
            Innstillinger
         </button>
      </div>

      <div id="GuserGrid" class="userGrid noselect">
         <div id="userGrid">
         </div>
      </div>

      <div id="Gfeed" class="noselect">
         <img id="feed" onclick="redirectToFeed();" draggable="false" class="icons" src="images/feedIcon.svg"
            alt="Feed">
         </img>
      </div>

      <div id="Gleaderboards" class="noselect">
         <img id="leaderboards" onclick="redirectToLeaderboards();" draggable="false" class="icons"
            src="images/leaderboardsIcon.svg" alt="Leaderboards">
         </img>
      </div>

      <div id="Gaccount" class="noselect">
         <img id="account" onclick="redirectToAccount();" draggable="false" class="icons"
            src="images/accountIconActive.svg" alt="Account">
         </img>
      </div>

   </section>

</body>

<script>

   let liftsLeft = null, goalsLeft = null;

   changeBodyPosition();
   getUserDetails();

   setInterval(() => {
      checkConnection("c6r2");
   }, 5000);

   function enableOverlay(aType) {

      const type = aType;
      const title1 = document.getElementById("title1");
      const inp1 = document.getElementById("inp1");
      const inp2 = document.getElementById("inp2");
      const inp3 = document.getElementById("inp3");
      const Gsave = document.getElementById("Gsave");
      const respMsg = document.getElementById("resp");

      const createNewLiftorGoalOverlay = document.getElementById("createNewLiftorGoalOverlay");

      title1.innerHTML = "";
      inp1.innerHTML = "";
      inp2.value = "";
      inp3.value = "";
      document.getElementById("inp2").innerHTML = "";
      document.getElementById("inp3").innerHTML = "";
      Gsave.innerHTML = "";
      respMsg.innerHTML = "";

      if (type === "lift" && liftsLeft) {
         title1.textContent = "Legg til nytt løft";
         const liftsLeftInfo = liftsLeft.info();

         if (liftsLeftInfo.length > 0) {
            for (let i = 0; i < liftsLeftInfo.length; i++) {
               inp1.innerHTML += `<option value="${liftsLeftInfo[i]}">${liftsLeftInfo[i]}`;
            }
            Gsave.innerHTML = `<button id="save" onclick="saveLiftOrGoal('lift');">Lagre</button>`;
         }

         createNewLiftorGoalOverlay.style.display = "block";

      } else if (type === "goal" && goalsLeft) {
         title1.textContent = "Legg til nytt mål";
         const goalsLeftInfo = goalsLeft.info();

         if (goalsLeftInfo.length > 0) {
            for (let i = 0; i < goalsLeftInfo.length; i++) {
               inp1.innerHTML += `<option value="${goalsLeftInfo[i]}">${goalsLeftInfo[i]}`;
            }
            Gsave.innerHTML = `<button id="save" onclick="saveLiftOrGoal('goal');">Lagre</button>`;
         }

         createNewLiftorGoalOverlay.style.display = "block";
      } else {
         alert(`Det har oppstått en feil: "${aType}" finnes ikke!`);
         return;
      }
   }

   function TliftsLeft(aLiftsLeft) {
      const liftsLeftInfo = aLiftsLeft;

      this.info = function () {
         return liftsLeftInfo;
      }

   }

   function TgoalsLeft(aGoalsLeft) {
      const goalsLeftInfo = aGoalsLeft;

      this.info = function () {
         return goalsLeftInfo;
      }

   }

   async function saveLiftOrGoal(aType) {

      const respMsg = document.getElementById("resp");

      if (aType === "lift" || aType === "goal") {

         const inp1 = document.getElementById("inp1").value;
         const inp2 = document.getElementById("inp2").value;
         const inp3 = document.getElementById("inp3").value;

         const validateInfo = validateLiftOrGoal(inp1, inp2, inp3, aType);

         if (validateInfo.isValid === true && validateInfo.info) {
            respMsg.textContent = "Lagrer...";
            console.log()

            const body = { "authToken": token, "userInfo": user, "info": validateInfo.info };
            const url = `/user/update/liftOrGoal/:${validateInfo.info}`;

            const resp = await callServerAPI(body, url);

            if (resp === true) {
               respMsg.textContent = "Lagret!";
               setTimeout(() => {
                  disableOverlay();
               }, 1500);
               setTimeout(() => {
                  getUserDetails();
               }, 2000);
            } else {
               respMsg.textContent = "Det har oppstått en feil!";
            }

         } else {
            respMsg.textContent = validateInfo.msg;
         }
      } else {
         respMsg.textContent = "Det har oppstått en feil!";
      }
   }

   function validateLiftOrGoal(aInp1, aInp2, aInp3, aType) {

      let isValid = false;
      let msg = "Vennligst fyll ut alle feltene!";
      let info = {};

      if (aInp1 && aInp2 && aInp3 && aType) {

         const input1 = aInp1;
         const input2 = aInp2;
         const input3 = aInp3;
         const type = aType;

         const onlyNumbers = /^[0-9.]+$/;

         const checkKG = input2.split(".");

         if (input2.match(onlyNumbers) && (checkKG.length > 2) === false) {
         } else {
            msg = "Antall KG er ugyldig! Eksempel: 120.25";
            return { "isValid": isValid, "msg": msg };
         }

         //Date format = YYYY-MM-DD
         const checkDateFormat = input3.split("-");
         if (checkDateFormat[0].length === 4 && checkDateFormat[1].length === 2 && checkDateFormat[2].length === 2) {
         } else {
            msg = "Dato er ugyldig!";
            return { "isValid": isValid, "msg": msg };
         }

         info = { "exercise": input1, "kg": input2, "date": input3, "type": type };

         isValid = true;

      }

      return { "isValid": isValid, "msg": msg, "info": info };

   }


   function onlyAllowedKeys(evt) {
      const code = (evt.which) ? evt.which : evt.keyCode;
      const inp2 = document.getElementById("inp2").value;

      if (inp2.length <= 5) {

         let length = 0;

         if (inp2.match(/\./g)) {
            length = inp2.match(/\./g).length;
         }

         if (code >= 48 && code <= 57 || code === 46 && length === 0) {
            return true;
         } else {
            return false;
         }
      } else {
         return false;
      }
   }


   function disableOverlay() {
      document.getElementById("createNewLiftorGoalOverlay").style.display = "none";
   }

</script>

</html>