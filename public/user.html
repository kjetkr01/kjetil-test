<!DOCTYPE html>
<html>

<head>
    <title>Laster...</title>

    <meta charset="utf-8" />

    <!-- manifest -->

    <link rel="manifest" href="manifest.json">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Treningsstatestikk">
    <meta name="apple-mobile-web-app-title" content="Treningsstatestikk">
    <meta name="msapplication-starturl" content="/">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=0">

    <link rel="icon" type="image/png" sizes="192x192" href="images/appIcon.png">
    <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="images/appIcon.png">

    <!-- -->

    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/user.css">

    <script src="scripts/global.js" type="text/javascript"></script>
    <script src="scripts/validateInfo.js" type="text/javascript"></script>
    <script src="scripts/script.js" type="text/javascript"></script>

    <script src="scripts/displayUserContent.js" type="text/javascript"></script>

</head>

<body>

    <section id="page">

        <!-- spacing items-->

        <div id="e1r1"></div>
        <div id="e2r1"></div>
        <div id="e3r1"></div>
        <div id="e4r1"></div>

        <!-- -->

        <!-- content items-->

        <div id="c1r1"></div>
        <div id="c2r1"></div>

        <div id="c1r2"></div>
        <div id="c2r2"></div>
        <div id="c3r2"></div>
        <div id="c4r2"></div>
        <div id="c5r2"></div>
        <div id="c6r2"></div>

        <div id="c1r3"></div>
        <div id="c2r3"></div>

        <!-- -->

        <!-- element content items-->

        <!-- header -->

        <div id="Glinks">
            <table id="links">

            </table>
        </div>

        <!-- -->

        <!-- content/middle -->

        <div id="displaynameG">
            <p id="displayname">

            </p>
        </div>

        <div id="infoListG">
            <table id="infoList">

            </table>
        </div>

        <div id="workoutTodayG">
            <p id="workoutToday">

            </p>
        </div>

        <div id="listTitleG">
            <p id="listTitle">

            </p>
        </div>

        <div id="listG">
            <table id="list">

            </table>
        </div>

        <div id="showTotalLiftG">
            <p id="showTotalLift">

            </p>
        </div>

        <div id="buttonsG">
            <table id="buttons">

            </table>
        </div>

        <div id="backBtnG">
            <p id="backBtn">
                <button class="listButton" onClick='window.history.back();'>Tilbake</button>
            </p>
        </div>

        <!-- -->

        <!-- footer -->

        <div id="Gfootermenu">
            <p id="footermenu">

            </p>
        </div>

        <!-- -->

    </section>

</body>

<script>

    displayLinks("links");
    checkColorTheme();

    let info = "";

    let displayname = "";
    let age = "";
    let height = "";
    let weight = "";
    let program = "";
    let lifts = "";
    let goals = "";

    const viewingUser = sessionStorage.getItem("ViewingUser");
    const listTitle = document.getElementById("listTitle");
    const list = document.getElementById("list");

    if (viewingUser) {
        document.title = viewingUser + " sin profil";
        getUserDetails()
    } else {
        window.history.back();
    }

    async function getUserDetails() {

        if (token && user) {

            const body = { "authToken": token, "userInfo": user, "viewingUser": viewingUser };
            const url = `/users/details/${viewingUser}`;

            const resp = await callServerAPI(body, url);

            if (resp) {

                if (resp.username) {
                    info = resp;
                    displayInformation();

                } else {
                    alert(resp);
                    window.history.back();

                }

            } else {
                alert("Brukeren " + viewingUser + " finnes ikke!");
                window.history.back();
            }
        }

    }

    function changelistContent(content) {

        if (content === "lifts" || content === "goal" || content === "plan") {

            list.innerHTML = "";
            document.getElementById("showTotalLift").innerHTML = "";
            sessionStorage.setItem("currentListContent", content);

            switch (content) {
                case "lifts":
                    displayLifts();
                    updateButtons(content);
                    break;
                case "goal":
                    displayGoals();
                    updateButtons(content);
                    break;
                case "plan":
                    displayProgram();
                    updateButtons(content);
                    break;
            }

        } else {
            changelistContent("lifts");
        }

    }

    function updateButtons(current) {

        if (!current) {
            return;
        }

        // buttons

        const buttons = document.getElementById("buttons");

        let buttonsString = "";

        buttons.innerHTML = "";

        if (Object.entries(lifts).length > 0 && current === "lifts") {
            //buttons.innerHTML += `<button class="activeColor" onClick="changelistContent('lifts')">Løft</button>`;
            buttonsString += `<td><button class="activeColor listButton" onClick="changelistContent('lifts')">Løft</button></td>`;
        } else if (Object.entries(lifts).length > 0) {
            //buttons.innerHTML += `<button onClick="changelistContent('lifts')">Løft</button>`;
            buttonsString += `<td><button class="listButton" onClick="changelistContent('lifts')">Løft</button></td>`;
        }

        if (Object.entries(goals).length > 0 && current === "goal") {
            //buttons.innerHTML += `<button class="activeColor" onClick="changelistContent('goal')">Mål</button>`;
            buttonsString += `<td><button class="activeColor listButton" onClick="changelistContent('goal')">Mål</button></td>`;
        } else if (Object.entries(goals).length > 0) {
            //buttons.innerHTML += `<button onClick="changelistContent('goal')">Mål</button>`;
            buttonsString += `<td><button class="listButton" onClick="changelistContent('goal')">Mål</button></td>`;
        }

        if (Object.entries(program).length > 0) {

            /*let keys = Object.keys(program);

            for (let i = 0; i < Object.entries(program).length; i++) {
                if (program[keys[i]].length > 0) {*/

            if (current === "plan") {
                //buttons.innerHTML += `<button class="activeColor" onClick="changelistContent('plan')">Treningsplan</button>`;
                buttonsString += `<td><button class="activeColor listButton" onClick="changelistContent('plan')">Treningsplan</button></td>`;
            } else {
                //buttons.innerHTML += `<button onClick="changelistContent('plan')">Treningsplan</button>`;
                buttonsString += `<td><button class="listButton" onClick="changelistContent('plan')">Treningsplan</button></td>`;
            }

            //}
            //}
        }

        buttons.innerHTML = `<tr>${buttonsString}</tr>`;

    }


</script>

</html>