<!DOCTYPE html>
<html>

<head>
    <title>Brukere</title>

    <meta charset="utf-8" />

    <!-- manifest -->

    <link rel="manifest" href="manifest.json">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Treningsstatestikk">
    <meta name="apple-mobile-web-app-title" content="Treningsstatestikk">
    <meta name="msapplication-starturl" content="/">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=0">

    <link rel="icon" type="image/png" sizes="192x192" href="images/appIcon.png">
    <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="images/appIcon.png">

    <!-- -->

    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/users.css">

    <script src="scripts/global.js" type="text/javascript"></script>
    <script src="scripts/validateInfo.js" type="text/javascript"></script>
    <script src="scripts/script.js" type="text/javascript"></script>

</head>

<body>

    <section id="page">

        <!-- spacing items-->

        <div id="e1r1"></div>
        <div id="e2r1"></div>
        <div id="e3r1"></div>
        <div id="e4r1"></div>

        <!-- -->

        <!-- content items-->

        <div id="c1r1"></div>
        <div id="c2r1"></div>

        <div id="c1r2"></div>
        <div id="c2r2"></div>
        <div id="c3r2"></div>
        <div id="c4r2"></div>
        <div id="c5r2"></div>
        <div id="c6r2"></div>

        <div id="c1r3"></div>
        <div id="c2r3"></div>

        <!-- -->

        <!-- element content items-->

        <!-- header -->

        <div id="Glinks">
            <table id="links">

            </table>
        </div>

        <!-- -->

        <!-- content/middle -->

        <div id="usermsg1G">
            <p id="usermsg1">

            </p>
        </div>

        <div id="listTitleG">
            <p id="listTitle">

            </p>
        </div>

        <div id="listG">
            <table id="list">

            </table>
        </div>

        <div id="backBtnG">
            <p id="backBtn">
                <button class="listButton" onClick="redirectToLeaderboards()">Tilbake</button>
            </p>
        </div>

        <!-- -->

        <!-- footer -->

        <div id="Gfootermenu">
            <p id="footermenu">

            </p>
        </div>

        <!-- -->

    </section>

</body>

<script>

    displayLinks("links");
    checkColorTheme();

    getListOfAllUsers();
    async function getListOfAllUsers() {

        if (token && user) {

            const getListOfAllUsersDiv = document.getElementById("list");
            const listTitle = document.getElementById("listTitle");
            const listTitleG = document.getElementById("listTitleG");
            const usermsg1 = document.getElementById("usermsg1");

            usermsg1.innerText = loadingText;
            listTitle.innerText = loadingText;

            const body = { "authToken": token, "userInfo": user };
            const url = `/users/list/all`;

            const resp = await callServerAPI(body, url);

            getListOfAllUsersDiv.innerHTML = "";

            if (resp && resp[0]) {

                listTitle.innerHTML = `Brukernavn`;

                listTitleG.innerHTML += `<hr>`;

                if (resp[0].username) {

                    for (let i = 0; i < resp.length; i++) {
                        getListOfAllUsersDiv.innerHTML += `
                        <tr>
                        <td><button class="listButton" onClick="viewUser('${resp[i].username}')">${resp[i].username}</button></td>
                    </tr>
                    `;
                    }

                    if(resp.length === 1){
                        usermsg1.innerText = "Det er totalt " + resp.length + " bruker!";
                    }else{
                        usermsg1.innerText = "Det er totalt " + resp.length + " brukere!";
                    }

                } else {
                    usermsg1.innerText = errorLoadingText;
                }

            } else {
                usermsg1.innerText = "Det er ingen brukere!";
            }

        }
    }

    function viewUser(viewUser) {

        if (viewUser) {
            sessionStorage.setItem("ViewingUser", viewUser);
            redirectToUser();
        }

    }

</script>

</html>