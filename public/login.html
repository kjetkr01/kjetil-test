<!DOCTYPE html>
<html>

<head>
   <title>Logg inn</title>

   <meta charset="utf-8" />

   <!-- manifest -->

   <link rel="manifest" href="manifest.json">

   <meta name="mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="application-name" content="Treningsstatistikken">
   <meta name="apple-mobile-web-app-title" content="Treningsstatistikken">
   <meta name="msapplication-starturl" content="/">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=0">

   <link rel="icon" type="image/png" sizes="192x192" href="images/appIcon.png">
   <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="images/appIcon.png">

   <!-- -->

   <!-- splashscreen for ios -->

   <link href="images/splashscreens/iphone5_splash.png"
      media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image" />
   <link href="images/splashscreens/iphone6_splash.png"
      media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image" />
   <link href="images/splashscreens/iphoneplus_splash.png"
      media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)"
      rel="apple-touch-startup-image" />
   <link href="images/splashscreens/iphonex_splash.png"
      media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)"
      rel="apple-touch-startup-image" />
   <link href="images/splashscreens/iphonexr_splash.png"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image" />
   <link href="images/splashscreens/iphonexsmax_splash.png"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)"
      rel="apple-touch-startup-image" />
   <link href="images/splashscreens/ipad_splash.png"
      media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image" />
   <link href="images/splashscreens/ipadpro1_splash.png"
      media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image" />
   <link href="images/splashscreens/ipadpro3_splash.png"
      media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image" />
   <link href="images/splashscreens/ipadpro2_splash.png"
      media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image" />

   <!-- -->

   <!-- status bar color -->

   <meta id="themeColor" name="theme-color" content="#357F9B">
   <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

   <!-- -->

   <link rel="stylesheet" href="styles/global/globalVariables.css">
   <link rel="stylesheet" href="styles/global/globalClasses.css">
   <link rel="stylesheet" href="styles/global/global.css">

   <link rel="stylesheet" href="styles/global/themes.css">

   <link rel="stylesheet" href="styles/login/desktop.css">
   <link rel="stylesheet" href="styles/login/mobile.css">
   <link rel="stylesheet" href="styles/login/common.css">

   <script src="ts_application.js" type="text/javascript"></script>
   <script src="scripts/global/appInfo.js" type="text/javascript"></script>
   <script src="scripts/global/global.js" type="text/javascript"></script>
   <script src="scripts/validate/validateInfo.js" type="text/javascript"></script>

</head>

<body>

   <script>changeColorTheme();</script>

   <section id="page">

      <div id="c1r2"></div>
      <div id="c2r2"></div>
      <div id="c3r2"></div>
      <div id="c4r2"></div>
      <div id="c5r2"></div>
      <div id="c6r2"></div>
      <div id="c7r2"></div>
      <div id="c8r2"></div>
      <div id="c9r2"></div>
      <div id="c10r2"></div>

      <div id="Gtitle">
         <p id="title" class="noselect">
            Logg inn
         </p>
      </div>

      <div id="GsmallTitle">
         <p id="smallTitle" class="noselect">

         </p>
      </div>

      <div id="Glogo">
         <img id="logo" src="" alt="" draggable="false" class="noselect"></img>
      </div>

      <script>
         document.getElementById("logo").src = application.logoURL || "";
      </script>

      <div id="Gline">
         <hr id="line" class="noselect">
      </div>

      <div id="Ginp1">
         <input id="inp1" placeholder="Brukernavn" autocapitalize="none" maxlength="20" type="text" required>
         </input>
      </div>

      <div id="Ginp2">
         <input id="inp2" placeholder="Passord" maxlength="20" type="password" required>
         </input>
      </div>

      <div id="GrmbrMeBtn">
         <input id="rmbrMeBtn" type="checkbox" class="noselect">
         </input>
      </div>

      <div id="GrmbrMeTxt">
         <p id="rmbrMeTxt" class="noselect">
            Husk meg i 30 dager
         </p>
      </div>

      <div id="GrespMsg">
         <p id="respMsg">
         </p>
      </div>

      <div id="GloginBtn">
         <button id="loginBtn" class="noselect pointer" onclick="loginUser();">
            Logg inn
         </button>
      </div>

      <div id="GnoAccBtn">
         <p id="noAccBtn" class="noselect">
            <a href="access.html">Ingen konto? <strong>Be om tilgang</strong></a>
         </p>
      </div>

   </section>

</body>

<script>

   checkIfCache();
   async function checkIfCache() {
      if (navigator.onLine) {
         const cachesKeys = await caches.keys();
         if (cachesKeys.length > 0) {
            /*document.getElementById("noAccBtn").innerHTML += `
            <br><br>
            Problemer med innlogging? Prøv:
            <button class="noselect clearCacheButton pointer" onClick="sessionStorage.clear();localStorage.clear();deleteCachesAndUnregisterSW();">
            Tøm cache
            </button>`;*/
            localStorage.clear();
            removeServiceWorker();
            deleteAllCaches();
         }
      }
   }

   const cachedUsername = sessionStorage.getItem("cachedUsername");

   if (cachedUsername && cachedUsername !== "null" && cachedUsername !== "undefined") {
      document.getElementById("inp1").value = cachedUsername;
   }

   document.getElementById("smallTitle").innerHTML = application.name || "";

   lockBodyPosition();

   addEventListener("keypress", function (evt) {

      if (evt.keyCode === 13) {
         loginUser();
      }

   });
   async function loginUser() {
      try {

         const respmsg = document.getElementById("respMsg");

         if (navigator.onLine) {

            const rmbrMe = document.getElementById("rmbrMeBtn").checked;

            const username = document.getElementById("inp1").value;
            const psw = document.getElementById("inp2");

            if (username && psw) {

               const resp = await login(username, psw.value, rmbrMe);

               if (resp === "Login successful") {
                  redirectToFeed();
               } else {
                  respmsg.innerHTML = resp;
                  psw.value = "";
               }
            }
         } else {
            respmsg.innerHTML = "Du må ha Internett-tilkobling for å logge inn!";
         }

      } catch (err) {
         alert(err);
      }
   };

</script>

</html>